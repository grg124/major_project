<%- include('../../Partials/layout.ejs') %>
<%- include('../../Partials/timer.ejs') %>
  <div class="container-fluid" onload="myPage.init()">
    <div class="tabs-area">
      <div class="tab">
          <%for(i=0;i<data.questionlist.length;i++){%>
            <button class="tablinks" onclick="openCity(event, `<%- data.examname %>`, `<%- data.sectionname %>`, `<%- data.questionlist[i] %>`, `<%- i %>`, `<%= user  %>`)"><%- data.questionlist[i].qname %></button>
          <%}%>
      </div>
              
      <div class="tabcontent">
          <div class="killing" >

              <div class="page-container">
                  <div class="panel-container">
                      <div class="panel-left">
                          <div>
                              <div class="quesrion-scroll">
                                <p id="problem" class=""><%- data.questionlist[0].qcode.problem %></p>
                                <p><span>Sample Input </span></p>
                                <p id="inputformat" class=""><%- data.questionlist[0].qcode.inputformat %></p>
                                <p><span>Sample Output </span></p>
                                <p id="outputformat" class=""><%- data.questionlist[0].qcode.outputformat %>></p>
                                <p><span>Constraints</span></p>
                                <p id="constraints" class=""><%- data.questionlist[0].qcode.constraints %></p>
                              </div>
                              
                            </div>
                      </div>
                      <div class="splitter">
                      </div>
                      <div class="panel-right">
                          <%- include('../../Partials/compiler.ejs') %>
                          <div id="result"></div>
                      </div>
                  </div>
              </div>
          
          </div>
      </div>        
      <div class="question-submit"><button class="submit-test btn btn-primary" type="submit">Submit Test</button></div>   
    </div>
  </div>



  <%- include('../../Partials/layoutfooter.ejs') %>
  <!-- <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script> -->
  <!-- <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script> -->
  <script src="/scripts/codemirror/lib/codemirror.js"></script>
  <link href="/scripts/codemirror/lib/codemirror.css" rel="stylesheet"/>
  <script src="/scripts/codemirror/mode/python/python.js"></script>
  <script src="/scripts/codemirror/mode/clike/clike.js"></script>
  <link href="/scripts/codemirror/theme/dracula.css" rel="stylesheet"/>
  <script src="/scripts/codemirror/addon/edit/closetag.js"></script>
  <script src="/scripts/codemirror/addon/edit/closebrackets.js"></script>
  <script src="/scripts/codemirror/addon/edit/matchbrackets.js"></script>
  <script src="/scripts/codemirror/addon/edit/matchtags.js"></script>
  <script src="/scripts/codemirror/addon/hint/show-hint.js"></script>
  <script src="/scripts/codemirror/addon/hint/css-hint.js"></script>
  <link href="/scripts/codemirror/addon/hint/show-hint.css" rel="stylesheet"/>
  <!-- <script>window.jQuery = window.$ = require('jquery');</script> -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://rawgit.com/RickStrahl/jquery-resizable/master/src/jquery-resizable.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
  <script>
    var selectedQuestion = 0 ;
    var exam;
    var section;
    var userId;
    var question;
      $(function(){
          $(".static_class").click(function(){
            if($(this).val() === "Yes")
              $("#extra").show("fast");
            else
              $("#extra").hide("fast");
          });
        });
      var editor = CodeMirror.fromTextArea
      (document.getElementById('editor'),{
          theme:"dracula",
          lineNumbers: true,
          autoCloseTags: true,
          matchBrackets: true,
          autoCloseBrackets: true,
          matchTags: false,
          extraKeys: {"Ctrl-Space": "autocomplete"}
      }); 
      $(document).ready(function() {
        $("#compilerbtn").on('click', function(e){
          var data = {};
          $.each($('#myform').serializeArray(), function(i, field) {
              data[field.name] = field.value;
          });
          data.code = editor.getValue();
            e.preventDefault();
            $.ajax({
                type: 'post',
                url: '/compilecode',
                data: data,
                dataType: 'json',
                success:function(data){
                  if(data.type == "success")
                    $('#result').html("Successfully Compiled And Executed");
                  else
                    $('#result').html(data.out);
                },error:function(error){
                  $('#result').html(error);
                  console.log(error);
                }
            })
        });
        $("#saveCode").on('click', function(e){
          var data = {};
          data.examname = exam;
          data.sectionname = section;
          data.qname = question;
          data.code = editor.getValue();
          data.userId = userId;
            e.preventDefault();
            $.ajax({
                type: 'post',
                url: '/Savecode',
                data: data,
                dataType: 'text',
                success:function(data){
                  $('#result').html("Successfully Saved");
                },error:function(error){
                  $('#result').html(error);
                  console.log(error);
                }
            })
        });
        $('#changeLanguage').change(function(){
            var option = this.value;
            if(option === "C")
                editor.setOption('mode', "text/x-csrc");
            else if(option === "C++")
                editor.setOption('mode', "text/x-c++src");
            else if(option === "Java")
                editor.setOption('mode', "text/x-java");
            else
                editor.setOption('mode', "text/x-python");
        }) 
      });

      var myPage = (function() {
        var that = {};
        that.init = function () {
          examname = document.getElementById("timerclass").innerText;
          user = document.getElementById("user").innerText;
        }
        return that;
      })();
  
    function openCity( evt, examname, sectionname, questionlist, index, user ) {
      selectedQuestion = parseInt(index);
      exam = examname;
      section = sectionname;
      question = questionlist.qname;
      userId = user;
      $.confirm({
            title: '',
            content: 'Do you want to move to next question?',
            buttons: {
                confirm: function () {
                  document.getElementById("problem").innerHTML = questionlist.qcode.problem;
                  document.getElementById("inputformat").innerHTML = questionlist.qcode.input;
                  document.getElementById("outputformat").innerHTML = questionlist.qcode.output;
                  document.getElementById("constraints").innerHTML = questionlist.qcode.constraints;
                
                  // Get all elements with class="tablinks" and remove the class "active"
                  tablinks = document.getElementsByClassName("tablinks");
                  for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                  }

                  // Show the current tab, and add an "active" class to the link that opened the tab
                  evt.path[0].className += " active";
                },
                cancel: function () {
                    console.log('canacel');
                },
            }
        });
    }

    

    $(".panel-left").resizable({
      handleSelector: ".splitter",
      resizeHeight: false,
      resizeWidth: false,
    });

    $(".panel-top").resizable({
      handleSelector: ".splitter-horizontal",
      resizeWidth: false,
   
 });
  </script>
</body>
</html>